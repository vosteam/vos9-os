# Архитектура VOS9-DOS

## Обзор системы

VOS9-DOS - это минималистичная 32-битная операционная система с DOS-совместимым интерфейсом командной строки. Система построена с нуля и предназначена для образовательных целей и изучения основ разработки операционных систем.

## Архитектурные принципы

### 1. Простота
- Минимальный набор компонентов
- Понятная структура кода
- Отсутствие лишних абстракций

### 2. Модульность
- Четкое разделение между ядром и оболочкой
- Независимые драйверы устройств
- Возможность расширения функциональности

### 3. DOS-совместимость
- Знакомый интерфейс командной строки
- Поддержка основных DOS-команд
- Совместимость на уровне пользовательского интерфейса

## Структура системы

```
VOS9-DOS
├── Загрузчик (boot/)
│   ├── boot.asm - Загрузочный сектор
│   └── loader.asm - Дополнительный загрузчик
├── Ядро (src/kernel/)
│   ├── kernel.c - Основное ядро
│   ├── memory.c - Управление памятью
│   └── interrupts.c - Обработка прерываний
├── Драйверы (src/drivers/)
│   ├── vga.c - Видеодрайвер
│   ├── keyboard.c - Драйвер клавиатуры
│   └── timer.c - Драйвер таймера
├── Оболочка (src/)
│   ├── shell.c - Командная оболочка
│   └── commands.c - Реализация команд
└── Библиотеки (src/lib/)
    ├── string.c - Работа со строками
    └── utils.c - Вспомогательные функции
```

## Компоненты системы

### Загрузчик
- **Размер**: 512 байт (один сектор)
- **Функции**: 
  - Инициализация процессора
  - Переключение в защищенный режим
  - Загрузка ядра в память
  - Передача управления ядру

### Ядро
- **Тип**: Монолитное ядро
- **Режим**: 32-битный защищенный режим
- **Функции**:
  - Управление памятью
  - Обработка прерываний
  - Планирование задач (базовое)
  - Интерфейс для драйверов

### Драйверы

#### VGA драйвер
- Режим: Текстовый 80x25
- Цвета: 16 цветов
- Функции: вывод текста, очистка экрана, управление курсором

#### Драйвер клавиатуры
- Поддержка: US QWERTY раскладка
- Функции: чтение нажатий клавиш, буферизация ввода

#### Драйвер таймера
- Частота: Программируемая
- Функции: системные часы, временные задержки

### Командная оболочка
- Интерфейс: DOS-совместимый
- Команды: 11 основных DOS-команд
- Парсинг: Анализ командной строки с параметрами

## Управление памятью

### Карта памяти
```
0x00000000 - 0x000003FF  Таблица векторов прерываний
0x00000400 - 0x000004FF  BIOS Data Area
0x00000500 - 0x00007BFF  Свободная память
0x00007C00 - 0x00007DFF  Загрузочный сектор
0x00007E00 - 0x0009FFFF  Свободная память
0x000A0000 - 0x000BFFFF  Видеопамять
0x000C0000 - 0x000FFFFF  BIOS ROM
0x00100000+              Расширенная память (ядро)
```

### Схема размещения
- **Ядро**: Загружается по адресу 0x100000 (1MB)
- **Стек**: Размещается в верхней части доступной памяти
- **Куча**: Динамическое выделение после ядра

## Обработка прерываний

### Системные прерывания
- **IRQ0**: Таймер (INT 0x20)
- **IRQ1**: Клавиатура (INT 0x21)
- **INT 0x80**: Системные вызовы

### Обработчики прерываний
```c
void timer_handler(void);    // Обработчик таймера
void keyboard_handler(void); // Обработчик клавиатуры
void syscall_handler(void);  // Системные вызовы
```

## Система ввода-вывода

### Текстовый режим VGA
- Разрешение: 80 символов × 25 строк
- Цветовая схема: 4 бита на цвет (фон + текст)
- Буфер: 0xB8000 (видеопамять)

### Клавиатурный ввод
- Протокол: PS/2
- Сканкоды: Set 1
- Буферизация: Кольцевой буфер

## Командный интерфейс

### Поддерживаемые команды
1. **HELP** - Справка по командам
2. **CLS** - Очистка экрана
3. **VER** - Информация о версии
4. **DATE** - Текущая дата
5. **TIME** - Текущее время
6. **DIR** - Список файлов
7. **TYPE** - Просмотр содержимого файла
8. **COPY** - Копирование файлов
9. **DEL** - Удаление файлов
10. **MD** - Создание директории
11. **EXIT** - Завершение работы

### Парсинг команд
```c
// Структура команды
typedef struct {
    char* name;        // Имя команды
    char* description; // Описание
    void (*function)(int argc, char* argv[]); // Функция
} command_t;
```

## Файловая система

### Текущее состояние
- Виртуальная файловая система (заглушки)
- Эмуляция базовых операций
- Подготовка к интеграции реальной ФС

### Планируемые возможности
- FAT12/FAT16 поддержка
- Работа с дискетами
- Базовые файловые операции

## Сборка и развертывание

### Процесс сборки
1. Компиляция ассемблерного кода (NASM)
2. Компиляция C кода (GCC)
3. Линковка компонентов
4. Создание образа диска
5. Генерация ISO образа

### Выходные файлы
- `vos9.img` - Образ дискеты
- `vos9.iso` - ISO образ для CD/DVD
- `kernel.bin` - Скомпилированное ядро

## Технические характеристики

### Системные требования
- **Процессор**: x86-совместимый (386+)
- **Память**: Минимум 1MB RAM
- **Загрузка**: Floppy disk или CD-ROM
- **Эмуляция**: QEMU, VirtualBox, VMware

### Ограничения
- Однопользовательская система
- Отсутствие многозадачности
- Ограниченная файловая система
- Базовый набор драйверов

## Расширяемость

### Точки расширения
1. **Драйверы**: Добавление новых устройств
2. **Команды**: Расширение shell функциональности
3. **Файловая система**: Интеграция реальной ФС
4. **Сеть**: Добавление сетевых возможностей

### API для разработчиков
```c
// Регистрация новой команды
int register_command(const char* name, 
                    const char* description,
                    command_function_t function);

// Регистрация драйвера
int register_driver(driver_t* driver);
```

## Заключение

VOS9-DOS представляет собой образовательную операционную систему, демонстрирующую основные принципы разработки ОС. Система спроектирована для изучения низкоуровневого программирования и понимания работы операционных систем.

Архитектура позволяет легко расширять функциональность и добавлять новые возможности, делая VOS9-DOS отличной платформой для экспериментов и обучения.
